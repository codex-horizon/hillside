<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试接口</title>
</head>
<body>
<script src="https://cdn.bootcdn.net/ajax/libs/axios/0.27.2/axios.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jsencrypt/3.2.1/jsencrypt.js"></script>
<script>
    const requestHttp = axios.create({
        baseURL: 'http://localhost:8080/hillside',
        headers: {
            'Content-Type': 'application/json'
        },
        timeout: 1.5 * 100000,
        withCredentials: true // 每次请求携带cookie
    });
    requestHttp.interceptors.request.use((config) => {
        return config;
    }, (error) => {
        return Promise.reject(error);
    });
    requestHttp.interceptors.response.use((response) => {
        if (response.status === 200) {
            // 因axios响应头会自动传小写，故转小写
            return Promise.resolve(response.data);
        }
        return Promise.reject(response.data);
    }, (error) => {
        return Promise.reject(error);
    });

    function to_base64(str)
    {
        var digits="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        var base64_rep = "";
        var cnt = 0;
        var bit_arr = 0;
        var bit_num = 0;

        for(var n = 0; n < str.length; ++n)
        {
            if(str[n] >= 'A' && str[n] <= 'Z')
            {
                ascv = str.charCodeAt(n) - 55;
            }
            else if(str[n] >= 'a' && str[n] <= 'z')
            {
                ascv = str.charCodeAt(n) - 87;
            }
            else
            {
                ascv = str.charCodeAt(n) - 48;
            }

            bit_arr = (bit_arr << 4) | ascv;
            bit_num += 4;
            if(bit_num >= 6)
            {
                bit_num -= 6;

                base64_rep += digits[bit_arr >>> bit_num];
                bit_arr &= ~(-1 << bit_num);
            }
        }

        if(bit_num > 0)
        {
            bit_arr <<= 6 - bit_num;
            base64_rep += digits[bit_arr];
        }
        var padding = base64_rep.length % 4;

        if(padding > 0)
        {
            for(var n = 0; n < 4 - padding; ++n)
            {
                base64_rep += "=";
            }
        }
        return base64_rep;
    }

    console.log(to_base64("十六进制的字符"));

    requestHttp.get('/account/t2b/fetchPublicKey').then(res => {
        const publicKey = res.body.data;
        let jsEncrypt = new JSEncrypt();
        jsEncrypt.setPublicKey(publicKey);
        let account = jsEncrypt.encrypt("13221811969");
        let password = jsEncrypt.encrypt("Wubc0229()");
        requestHttp.get(`/account/t2b/fetchXToken?account=${account}&password=${password}`).then(res1 => {
            console.info(res1);
        }).catch(error => {
            console.error(error);
        });
    }).catch(error => {
        console.error(error);
    });
</script>
</body>
</html>